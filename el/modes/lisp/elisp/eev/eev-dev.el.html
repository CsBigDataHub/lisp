<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.16 in css mode. -->
<html>
  <head>
    <title>eev-dev.el (htmlized)</title>
    <style type="text/css">
    <!--
      body {
        color: #ffe4c4;
        background-color: #000000;
      }
      .builtin {
        /* font-lock-builtin-face */
        color: #b0c4de;
      }
      .comment {
        /* font-lock-comment-face */
        color: #ff7f24;
      }
      .comment-delimiter {
      }
      .constant {
        /* font-lock-constant-face */
        color: #7fffd4;
      }
      .doc {
      }
      .eev-glyph-face-green {
        /* eev-glyph-face-green */
        color: #00ff00;
      }
      .eev-glyph-face-red {
        /* eev-glyph-face-red */
        color: #ff0000;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #87cefa;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #00ffff;
      }
      .negation-char {
      }
      .regexp-grouping-backslash {
      }
      .regexp-grouping-construct {
      }
      .string {
        /* font-lock-string-face */
        color: #ffa07a;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #eedd82;
      }
      .warning {
        /* font-lock-warning-face */
        color: #ffc0cb;
        font-weight: bold;
      }
      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="comment-delimiter">;;; </span><span class="comment">eev-dev.el -- add support for e-scripts in Emacs.
</span><span class="comment-delimiter">;;; </span><span class="comment">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; Use eev.el instead of this file &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
</span>
<span class="comment-delimiter">;; </span><span class="comment">Copyright (C) 1999,2000,2001,2002,2003,2004,2005 Free Software
</span><span class="comment-delimiter">;; </span><span class="comment">Foundation, Inc.
</span><span class="comment-delimiter">;;</span><span class="comment">
</span><span class="comment-delimiter">;; </span><span class="comment">This file is part of GNU eev.
</span><span class="comment-delimiter">;;</span><span class="comment">
</span><span class="comment-delimiter">;; </span><span class="comment">GNU eev is free software; you can redistribute it and/or modify
</span><span class="comment-delimiter">;; </span><span class="comment">it under the terms of the GNU General Public License as published by
</span><span class="comment-delimiter">;; </span><span class="comment">the Free Software Foundation; either version 2, or (at your option)
</span><span class="comment-delimiter">;; </span><span class="comment">any later version.
</span><span class="comment-delimiter">;;</span><span class="comment">
</span><span class="comment-delimiter">;; </span><span class="comment">GNU eev is distributed in the hope that it will be useful,
</span><span class="comment-delimiter">;; </span><span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of
</span><span class="comment-delimiter">;; </span><span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
</span><span class="comment-delimiter">;; </span><span class="comment">GNU General Public License for more details.
</span><span class="comment-delimiter">;;</span><span class="comment">
</span><span class="comment-delimiter">;; </span><span class="comment">You should have received a copy of the GNU General Public License
</span><span class="comment-delimiter">;; </span><span class="comment">along with GNU Emacs; see the file COPYING.  If not, write to the
</span><span class="comment-delimiter">;; </span><span class="comment">Free Software Foundation, Inc., 59 Temple Place - Suite 330,
</span><span class="comment-delimiter">;; </span><span class="comment">Boston, MA 02111-1307, USA.
</span><span class="comment-delimiter">;;</span><span class="comment">
</span><span class="comment-delimiter">;; </span><span class="comment">Author:     Eduardo Ochs &lt;<a href="mailto:edrx&#64;mat.puc-rio.br">edrx&#64;mat.puc-rio.br</a>&gt;
</span><span class="comment-delimiter">;; </span><span class="comment">Maintainer: Eduardo Ochs &lt;<a href="mailto:edrx&#64;mat.puc-rio.br">edrx&#64;mat.puc-rio.br</a>&gt;
</span><span class="comment-delimiter">;; </span><span class="comment">Version:    2005feb14
</span><span class="comment-delimiter">;; </span><span class="comment">Keywords:   e-scripts, help, hyperlinks, hypertext, processes,
</span><span class="comment-delimiter">;;             </span><span class="comment">shell, tex
</span>
<span class="comment-delimiter">;;; </span><span class="comment">Commentary:
</span>
<span class="comment-delimiter">;; </span><span class="comment">For a description of what eev and e-scripts are please see the
</span><span class="comment-delimiter">;; </span><span class="comment">README.
</span><span class="comment-delimiter">;;</span><span class="comment">
</span><span class="comment-delimiter">;; </span><span class="comment">Note: in mid-2004 I decided to rewrite eev. The new version had
</span><span class="comment-delimiter">;; </span><span class="comment">almost all code in a single file - called `</span><span class="comment"><span class="constant">eev-dev.el</span></span><span class="comment">' - and had no
</span><span class="comment-delimiter">;; </span><span class="comment">changelogs or docstrings. That will be fixed at some point in the
</span><span class="comment-delimiter">;; </span><span class="comment">future.
</span><span class="comment-delimiter">;;</span><span class="comment">
</span><span class="comment-delimiter">;; </span><span class="comment">Latest version: &lt;<a href="http://angg.twu.net/eev-current/eev-dev.el">http://angg.twu.net/eev-current/eev-dev.el</a>&gt;
</span><span class="comment-delimiter">;;       </span><span class="comment">htmlized: &lt;<a href="http://angg.twu.net/eev-current/eev-dev.el.html">http://angg.twu.net/eev-current/eev-dev.el.html</a>&gt;
</span><span class="comment-delimiter">;;       </span><span class="comment">See also: &lt;<a href="http://angg.twu.net/eev-current/README.html">http://angg.twu.net/eev-current/README.html</a>&gt;
</span><span class="comment-delimiter">;;            </span><span class="comment">and: &lt;<a href="http://angg.twu.net/eev-current/eev-langs.el.html">http://angg.twu.net/eev-current/eev-langs.el.html</a>&gt;
</span>
<span class="comment-delimiter">;; </span><span class="comment">Structure of this file:
</span><span class="comment-delimiter">;; </span><span class="comment">autoloads for external functions
</span><span class="comment-delimiter">;; </span><span class="comment">environment variables
</span><span class="comment-delimiter">;; </span><span class="comment">variables
</span><span class="comment-delimiter">;; </span><span class="comment">tools for calling hyperlink functions interactively
</span><span class="comment-delimiter">;; </span><span class="comment">basic hyperlinks (to text files and info nodes)
</span><span class="comment-delimiter">;; </span><span class="comment">hyperlinks to the output of Emacs's help-like functions
</span><span class="comment-delimiter">;; </span><span class="comment">hyperlinks to some things internal to Emacs (functions, variables, etc)
</span><span class="comment-delimiter">;; </span><span class="comment">hyperlinks to the output of shell commands
</span><span class="comment-delimiter">;; </span><span class="comment">hyperlinks to manpages
</span><span class="comment-delimiter">;; </span><span class="comment">hyperlinks to files in html
</span><span class="comment-delimiter">;; </span><span class="comment">hyperlinks to pages in dvi/ps/pdf documents
</span><span class="comment-delimiter">;; </span><span class="comment">hyperlinks to anchors
</span><span class="comment-delimiter">;; </span><span class="comment">hyperlinks to information about Debian packages
</span><span class="comment-delimiter">;; </span><span class="comment">mass-producing hyperlink functions
</span><span class="comment-delimiter">;; </span><span class="comment">mass-producing hyperlink functions: examples (debian-centric)
</span><span class="comment-delimiter">;; </span><span class="comment">temporary highlighting (flashing)
</span><span class="comment-delimiter">;; </span><span class="comment">evaluating sexps (alternatives to eval-last-sexp)
</span><span class="comment-delimiter">;; </span><span class="comment">saving regions (as temporary scripts)
</span><span class="comment-delimiter">;; </span><span class="comment">auxiliary functions for saving delimited ("bounded") regions
</span><span class="comment-delimiter">;; </span><span class="comment">the default action on bounded regions
</span><span class="comment-delimiter">;; </span><span class="comment">saving delimited regions
</span><span class="comment-delimiter">;; </span><span class="comment">hyperlinks to key sequences and series of Emacs actions
</span><span class="comment-delimiter">;; </span><span class="comment">eev-newbie and eev-demos
</span><span class="comment-delimiter">;; </span><span class="comment">more tools
</span><span class="comment-delimiter">;; </span><span class="comment">starting background processes
</span><span class="comment-delimiter">;; </span><span class="comment">sending strings to external programs through "channels"
</span><span class="comment-delimiter">;; </span><span class="comment">sending strings through "channels": high-level functions
</span><span class="comment-delimiter">;; </span><span class="comment">eev keys mode
</span><span class="comment-delimiter">;; </span><span class="comment">invading the global namespace
</span><span class="comment-delimiter">;; </span><span class="comment">aliases for compatibility with previous versions
</span>


<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">autoloads for external functions
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
<span class="comment-delimiter">;; <a href="http://www.gnu.org/software/emacs/elisp-manual/html_node/elisp_toc.html">(find-elnode "Autoload")</a></span><span class="comment">
</span>
(autoload 'Info-goto-node <span class="string">"info"</span>)
(autoload 'Info-find-node <span class="string">"info"</span>)
(autoload 'find-function-read <span class="string">"find-func"</span>)
(autoload 'pp-to-string <span class="string">"pp"</span>)
(autoload 'Man-fontify-manpage <span class="string">"man"</span> nil t)
(autoload 'word-at-point <span class="string">"thingatpt"</span>)



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">environment variables
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
<span class="comment-delimiter">;; </span><span class="comment">(find-eevrcfile ".bashrc")
</span><span class="comment-delimiter">;; </span><span class="comment">(find-eevrcfile ".zshrc")
</span>
(<span class="keyword">defun</span> <a name="ee-expand"><span class="function-name">ee-expand</span></a> (fname)
<span class="doc">"Expand \"~\"s and \"$ENVVAR\"s in file names, but only at the beginning of the string."</span>
  (<span class="keyword">cond</span> ((string-match <span class="string">"^\\$</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[A-Za-z_][0-9A-Za-z_]*</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">.*</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">"</span> fname)
         (concat (getenv (match-string 1 fname))
                 (match-string 2 fname)))
        ((string-match <span class="string">"^</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">~</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[a-z][0-9a-z_]*</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">?</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">/.*</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">?$"</span> fname)
         (concat (expand-file-name (match-string 1 fname))
                 (match-string 3 fname)))
        (t fname)))

(<span class="keyword">defun</span> <a name="ee-setenv"><span class="function-name">ee-setenv</span></a> (envvar value)
  <span class="doc">"In case the environment variable ENVVAR was not set set it to VALUE."</span>
  (<span class="keyword">if</span> (null (getenv envvar))
      (setenv envvar (ee-expand value))))

(ee-setenv <span class="string">"EEVDIR"</span>    <span class="string">"~/eev-current"</span>)
(ee-setenv <span class="string">"EEVRCDIR"</span>  <span class="string">"$EEVDIR/rcfiles"</span>)
(ee-setenv <span class="string">"EEVTMPDIR"</span> <span class="string">"$EEVDIR/tmp"</span>)
(ee-setenv <span class="string">"EE"</span>        <span class="string">"$EEVTMPDIR/ee.sh"</span>)
(ee-setenv <span class="string">"EEG"</span>       <span class="string">"$EEVTMPDIR/ee.eeg"</span>)
(ee-setenv <span class="string">"EEGDB"</span>     <span class="string">"$EEVTMPDIR/ee.gdb"</span>)
(ee-setenv <span class="string">"EETEX"</span>     <span class="string">"$EEVTMPDIR/ee.tex"</span>)
(ee-setenv <span class="string">"EEC"</span>       <span class="string">"$EEVTMPDIR/ee.c"</span>)
(ee-setenv <span class="string">"EETMPC"</span>    <span class="string">"$EEVTMPDIR/tmp.c"</span>)
(ee-setenv <span class="string">"EEAOUT"</span>    <span class="string">"$EEVTMPDIR/ee.aout"</span>)


<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">variables
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
<span class="comment-delimiter">;; </span><span class="comment">(setq eeb-highlight-spec '(highlight 0.2))
</span>(<span class="keyword">defvar</span> <a name="ee-highlight-spec"><span class="variable-name">ee-highlight-spec</span></a>  '(highlight 0.75)) <span class="comment-delimiter">; </span><span class="comment">to do: rename highlight-&gt;flash
</span>(<span class="keyword">defvar</span> <a name="eeb-highlight-spec"><span class="variable-name">eeb-highlight-spec</span></a> '(highlight 0.5))
(<span class="keyword">defvar</span> <a name="eek-highlight-spec"><span class="variable-name">eek-highlight-spec</span></a> '(region 0.75))
(<span class="keyword">defvar</span> <a name="eeflash-default"><span class="variable-name">eeflash-default</span></a> '(highlight 0.5))

(<span class="keyword">defvar</span> <a name="ee-eevdir"><span class="variable-name">ee-eevdir</span></a>       (ee-expand <span class="string">"$EEVDIR/"</span>))
(<span class="keyword">defvar</span> <a name="ee-eevtmpdir"><span class="variable-name">ee-eevtmpdir</span></a>    (ee-expand <span class="string">"$EEVTMPDIR/"</span>))
(<span class="keyword">defvar</span> <a name="ee-eevrcdir"><span class="variable-name">ee-eevrcdir</span></a>     (ee-expand <span class="string">"$EEVRCDIR/"</span>))
(<span class="keyword">defvar</span> <a name="ee-file"><span class="variable-name">ee-file</span></a>         (ee-expand <span class="string">"$EE"</span>))
(<span class="keyword">defvar</span> <a name="ee-file-tex"><span class="variable-name">ee-file-tex</span></a>     (ee-expand <span class="string">"$EETEX"</span>))
(<span class="keyword">defvar</span> <a name="ee-file-gdb"><span class="variable-name">ee-file-gdb</span></a>     (ee-expand <span class="string">"$EEGDB"</span>))
(<span class="keyword">defvar</span> <a name="ee-file-generic"><span class="variable-name">ee-file-generic</span></a> (ee-expand <span class="string">"$EEG"</span>))

(<span class="keyword">defvar</span> <a name="eelatex-eevscript"><span class="variable-name">eelatex-eevscript</span></a> <span class="string">"cd $EEVTMPDIR/; latex tmp.tex &amp;&amp; xdvi tmp.dvi &amp;"</span>)
(<span class="keyword">defvar</span> <a name="ee-delimiter-hash"><span class="variable-name">ee-delimiter-hash</span></a>    <span class="string">"\n#</span><span class="eev-glyph-face-red">*</span><span class="string">\n"</span>)
(<span class="keyword">defvar</span> <a name="ee-delimiter-percent"><span class="variable-name">ee-delimiter-percent</span></a> <span class="string">"\n%</span><span class="eev-glyph-face-red">*</span><span class="string">\n"</span>)
(<span class="keyword">defvar</span> <a name="ee-delimiter-semicolon"><span class="variable-name">ee-delimiter-semicolon</span></a> <span class="string">"\n;;</span><span class="eev-glyph-face-red">*</span><span class="string">\n"</span>)

(<span class="keyword">defvar</span> <a name="ee-find-man-flag"><span class="variable-name">ee-find-man-flag</span></a> nil)           <span class="comment-delimiter">; </span><span class="comment">for asynchronous `</span><span class="comment"><span class="constant">ee-goto-position</span></span><span class="comment">'s
</span>(<span class="keyword">defvar</span> <a name="ee-find-man-pos-spec-list"><span class="variable-name">ee-find-man-pos-spec-list</span></a> nil)  <span class="comment-delimiter">; </span><span class="comment">for asynchronous `</span><span class="comment"><span class="constant">ee-goto-position</span></span><span class="comment">'s
</span>(<span class="keyword">defvar</span> <a name="ee-buffer-name"><span class="variable-name">ee-buffer-name</span></a> nil)             <span class="comment-delimiter">; </span><span class="comment">overridden by `</span><span class="comment"><span class="constant">let</span></span><span class="comment">'s
</span>(<span class="keyword">defvar</span> <a name="ee-arg"><span class="variable-name">ee-arg</span></a> nil)                     <span class="comment-delimiter">; </span><span class="comment">overridden by `</span><span class="comment"><span class="constant">let</span></span><span class="comment">'s
</span>(<span class="keyword">defvar</span> <a name="ee-once"><span class="variable-name">ee-once</span></a> nil)                    <span class="comment-delimiter">; </span><span class="comment">overridden by `</span><span class="comment"><span class="constant">let</span></span><span class="comment">'s
</span>(<span class="keyword">defvar</span> <a name="ee-info-file"><span class="variable-name">ee-info-file</span></a> nil)               <span class="comment-delimiter">; </span><span class="comment">for eev-insert.el
</span>(<span class="keyword">defvar</span> <a name="ee-info-code"><span class="variable-name">ee-info-code</span></a> nil)               <span class="comment-delimiter">; </span><span class="comment">for eev-insert.el
</span>(<span class="keyword">defvar</span> <a name="ee-pop-up-windows"><span class="variable-name">ee-pop-up-windows</span></a> nil)          <span class="comment-delimiter">; </span><span class="comment">for an eegud hack, not working
</span>
(<span class="keyword">defvar</span> <a name="eeb-defaults"><span class="variable-name">eeb-defaults</span></a> '(eev ee-delimiter-hash nil t t))

(<span class="keyword">defvar</span> <a name="eesteps-pos"><span class="variable-name">eesteps-pos</span></a> 0)
(<span class="keyword">defvar</span> <a name="eesteps-list"><span class="variable-name">eesteps-list</span></a> ())
(<span class="keyword">defvar</span> <a name="eechannel-default"><span class="variable-name">eechannel-default</span></a> nil)

<span class="comment-delimiter">;; </span><span class="comment">(defvar eev-mode-map nil)            ; moved down to make the html nicer
</span>
(<span class="keyword">defvar</span> <a name="code-c-d-list"><span class="variable-name">code-c-d-list</span></a> nil
  <span class="doc">"Each (code-c-d C D) call generates an entry (C (ee-expand D)) in this list.
A new entry with the same C as a previous one removes the old one.
See `</span><span class="doc"><span class="constant">code-c-d-register</span></span><span class="doc">'."</span>)




<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">tools for calling hyperlink functions interactively
</span><span class="comment-delimiter">;;; </span><span class="comment">inspired by: (find-efile "thingatpt.el")
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defmacro</span> <a name="ee-maybe-showing-it"><span class="function-name">ee-maybe-showing-it</span></a> (it)
  `(<span class="keyword">let</span> ((value ,it))
     (<span class="keyword">if</span> ,show-it (message <span class="string">"%S"</span> value))
     value))

(<span class="keyword">defun</span> <a name="ee-stuff-around-point"><span class="function-name">ee-stuff-around-point</span></a> (chars <span class="type">&amp;optional</span> show-it)
  (interactive <span class="string">"MChars: \np"</span>)
  (ee-maybe-showing-it
   (<span class="keyword">save-excursion</span>
     (<span class="keyword">let*</span> ((e (<span class="keyword">progn</span> (skip-chars-forward  chars) (point)))
            (s (<span class="keyword">progn</span> (skip-chars-backward chars) (point))))
       (buffer-substring s e)))))

(<span class="keyword">defun</span> <a name="ee-debpkgname-around-point"><span class="function-name">ee-debpkgname-around-point</span></a> (<span class="type">&amp;optional</span> show-it)
  (interactive <span class="string">"p"</span>)
  (ee-stuff-around-point <span class="string">"a-z0-9-+."</span> show-it))

(<span class="keyword">defun</span> <a name="ee-debpkgname-ask"><span class="function-name">ee-debpkgname-ask</span></a> (<span class="type">&amp;optional</span> prompt show-it)
  (interactive (list nil t))
  (ee-maybe-showing-it
   (read-string (or prompt <span class="string">"Debian package name: "</span>)
                (ee-debpkgname-around-point))))

(<span class="keyword">defun</span> <a name="ee-manpagename-around-point"><span class="function-name">ee-manpagename-around-point</span></a> (<span class="type">&amp;optional</span> show-it)  
  (interactive <span class="string">"p"</span>)
  (ee-stuff-around-point <span class="string">"A-Za-z0-9-+_:."</span> show-it))

(<span class="keyword">defun</span> <a name="ee-manpagename-ask"><span class="function-name">ee-manpagename-ask</span></a> (<span class="type">&amp;optional</span> prompt show-it)
  (interactive (list nil t))
  (ee-maybe-showing-it
   (read-string (or prompt <span class="string">"Manpage: "</span>)
                (ee-manpagename-around-point))))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">basic hyperlinks (to text files and info nodes)
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="ee-goto-position"><span class="function-name">ee-goto-position</span></a> (<span class="type">&amp;optional</span> pos-spec <span class="type">&amp;rest</span> rest)
  (<span class="keyword">if</span> (or pos-spec rest)
      (goto-char (point-min)))
  (<span class="keyword">when</span> pos-spec
    (<span class="keyword">cond</span> ((numberp pos-spec)
           (forward-line (1- pos-spec)))
          ((stringp pos-spec)
           (search-forward pos-spec))
          (t (<span class="warning">error</span> <span class="string">"This is not a valid pos-spec: %S"</span> pos-spec)))
    (<span class="keyword">if</span> rest (ee-goto-rest rest))))

(<span class="keyword">defun</span> <a name="ee-goto-rest"><span class="function-name">ee-goto-rest</span></a> (list)
  (<span class="keyword">cond</span> ((stringp (car list))
         (search-forward (car list))
         (ee-goto-rest (cdr list)))))

(<span class="keyword">defun</span> <a name="find-fline"><span class="function-name">find-fline</span></a> (fname <span class="type">&amp;rest</span> pos-spec-list)
  (find-file (ee-expand fname))
  (apply 'ee-goto-position pos-spec-list))

(<span class="keyword">defun</span> <a name="find-node"><span class="function-name">find-node</span></a> (nodestr <span class="type">&amp;rest</span> pos-spec-list)
  (Info-goto-node nodestr)
  (apply 'ee-goto-position pos-spec-list))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">hyperlinks to the output of Emacs's help-like functions
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="find-wottb-call"><span class="function-name">find-wottb-call</span></a> (sexp bufname <span class="type">&amp;rest</span> pos-spec-list)
  <span class="doc">"Hyperlink to functions that call `</span><span class="doc"><span class="constant">with-output-to-temp-buffer</span></span><span class="doc">'.
First evaluate SEXP with a trick to not let it split the current window,
then switch to the buffer that it created (it must be called BUFNAME),
then go to the position specified by POS-SPEC-LIST.\n
 (Do I need to say that this is a horrible hack?)"</span>
  (<span class="keyword">let</span> ((same-window-buffer-names
         (cons bufname same-window-buffer-names)))
    (eval sexp))
  (set-buffer bufname)                  <span class="comment-delimiter">; </span><span class="comment">why is this needed?
</span>  (apply 'ee-goto-position pos-spec-list))

(<span class="keyword">defun</span> <a name="find-eapropos"><span class="function-name">find-eapropos</span></a> (regexp <span class="type">&amp;rest</span> pos-spec-list)
  (interactive <span class="string">"sApropos symbol (regexp): "</span>)
  (apply 'find-wottb-call '(apropos regexp) <span class="string">"*Apropos*"</span> pos-spec-list))

(<span class="keyword">defun</span> <a name="find-efunctiondescr"><span class="function-name">find-efunctiondescr</span></a> (symbol <span class="type">&amp;rest</span> pos-spec-list)
  (interactive (find-function-read))
  (apply 'find-wottb-call '(describe-function symbol) <span class="string">"*Help*"</span> pos-spec-list))

(<span class="keyword">defun</span> <a name="find-evariabledescr"><span class="function-name">find-evariabledescr</span></a> (symbol <span class="type">&amp;rest</span> pos-spec-list)
  (interactive (find-function-read 'variable))
  (apply 'find-wottb-call '(describe-variable symbol) <span class="string">"*Help*"</span> pos-spec-list))

(<span class="keyword">defalias</span> '<a name="find-evardescr"><span class="function-name">find-evardescr</span></a> 'find-evariabledescr)

(<span class="keyword">defun</span> <a name="find-ekeydescr"><span class="function-name">find-ekeydescr</span></a> (key <span class="type">&amp;rest</span> pos-spec-list)
  (interactive <span class="string">"kFind function on key: "</span>)
  (apply 'find-wottb-call '(describe-key key) <span class="string">"*Help*"</span> pos-spec-list))

(<span class="keyword">defun</span> <a name="find-efacedescr"><span class="function-name">find-efacedescr</span></a> (face <span class="type">&amp;rest</span> pos-spec-list)
  (interactive (list (read-face-name <span class="string">"Describe face"</span>)))
  (apply 'find-wottb-call '(describe-face face) <span class="string">"*Help*"</span> pos-spec-list))

(<span class="keyword">defun</span> <a name="find-efaces"><span class="function-name">find-efaces</span></a> (<span class="type">&amp;rest</span> pos-spec-list)
  (interactive)
  (apply 'find-wottb-call '(list-faces-display) <span class="string">"*Faces*"</span> pos-spec-list))

(<span class="keyword">defun</span> <a name="find-ecolors"><span class="function-name">find-ecolors</span></a> (<span class="type">&amp;rest</span> pos-spec-list)
  (interactive)
  (apply 'find-wottb-call '(list-colors-display) <span class="string">"*Colors*"</span> pos-spec-list))

(<span class="keyword">defun</span> <a name="find-efunctiond"><span class="function-name">find-efunctiond</span></a> (function <span class="type">&amp;rest</span> pos-spec-list)
  (interactive (find-function-read))
  (apply 'find-wottb-call '(disassemble function) <span class="string">"*Disassemble*"</span>
         pos-spec-list))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">hyperlinks to some things internal to Emacs (functions, variables, etc)
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="find-ebufferandpos"><span class="function-name">find-ebufferandpos</span></a> (buffer-and-pos <span class="type">&amp;rest</span> rest)
  (<span class="keyword">if</span> (not (bufferp (car buffer-and-pos)))
      (<span class="warning">error</span> <span class="string">"Bad (BUFFER . POS): %S"</span> buffer-and-pos))
  (switch-to-buffer (car buffer-and-pos))
  (goto-char (cdr buffer-and-pos))
  (ee-goto-rest rest))

(<span class="keyword">defun</span> <a name="find-efunction"><span class="function-name">find-efunction</span></a> (symbol <span class="type">&amp;rest</span> rest)
  (interactive (find-function-read))
  (apply 'find-ebufferandpos (find-function-noselect symbol) rest))

(<span class="keyword">defun</span> <a name="find-evariable"><span class="function-name">find-evariable</span></a> (symbol <span class="type">&amp;rest</span> rest)
  (interactive (find-function-read 'variable))
  (apply 'find-ebufferandpos (find-variable-noselect symbol) rest))

(<span class="keyword">defun</span> <a name="find-eCfunction"><span class="function-name">find-eCfunction</span></a> (fun <span class="type">&amp;rest</span> rest)
  (interactive (find-function-read))
  (apply 'find-ebufferandpos
         (find-function-search-for-symbol
          fun nil (help-C-file-name (indirect-function fun) 'fun))
         rest))

(<span class="keyword">defun</span> <a name="find-eCvariable"><span class="function-name">find-eCvariable</span></a> (symbol <span class="type">&amp;rest</span> rest)
  (interactive (find-function-read 'variable))
  (apply 'find-ebufferandpos
         (find-variable-noselect
          symbol (help-C-file-name symbol 'var))
         rest))



(<span class="keyword">defun</span> <a name="find-ebuffer"><span class="function-name">find-ebuffer</span></a> (buffer <span class="type">&amp;rest</span> rest)
  (interactive <span class="string">"bBuffer: "</span>)
  (switch-to-buffer buffer)
  (apply 'ee-goto-position rest))

(<span class="keyword">defalias</span> '<a name="find-escratchbuffer"><span class="function-name">find-escratchbuffer</span></a> 'find-ebuffer) <span class="comment-delimiter">; </span><span class="comment">missing: check scratchness
</span>
(<span class="keyword">defun</span> <a name="find-estring"><span class="function-name">find-estring</span></a> (str <span class="type">&amp;rest</span> pos-spec-list)
  (find-escratchbuffer (or ee-buffer-name <span class="string">"*string*"</span>))
  (delete-region (point-min) (point-max))
  (insert str)
  (goto-char (point-min))
  (apply 'ee-goto-position pos-spec-list))

(<span class="keyword">defun</span> <a name="find-epp"><span class="function-name">find-epp</span></a> (object <span class="type">&amp;rest</span> pos-spec-list)
  (<span class="keyword">let</span> ((ee-buffer-name (or ee-buffer-name <span class="string">"*pp*"</span>)))
    (apply 'find-estring (pp-to-string object) pos-spec-list)))

(<span class="keyword">defun</span> <a name="find-epp0"><span class="function-name">find-epp0</span></a> (object)
  (message (ee-pp0 object)))

(<span class="keyword">defun</span> <a name="find-efunctionpp"><span class="function-name">find-efunctionpp</span></a> (symbol <span class="type">&amp;rest</span> pos-spec-list)
  (interactive (find-function-read))
  (<span class="keyword">let</span> ((ee-buffer-name
         (or ee-buffer-name (format <span class="string">"*function %S*"</span> symbol))))
    (apply 'find-epp
           (symbol-function symbol)
           <span class="comment-delimiter">;; </span><span class="comment">or: `(fset ',symbol ',(symbol-function symbol))
</span>           pos-spec-list)))

(<span class="keyword">defun</span> <a name="find-etpat"><span class="function-name">find-etpat</span></a> (<span class="type">&amp;rest</span> rest)
  (interactive)
  (<span class="keyword">let*</span> ((ee-buffer-name
          (or ee-buffer-name <span class="string">"*(text-properties-at (point))*"</span>)))
    (apply 'find-epp (text-properties-at (point)) rest)))

(<span class="keyword">defun</span> <a name="find-etpat0"><span class="function-name">find-etpat0</span></a> ()
  (interactive)
  (find-epp0 (text-properties-at (point))))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">hyperlinks to the output of shell commands
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="find-sh"><span class="function-name">find-sh</span></a> (command <span class="type">&amp;rest</span> pos-spec-list)
  (interactive <span class="string">"sShell command: "</span>)
  (<span class="keyword">if</span> (get-buffer command)              <span class="comment-delimiter">; </span><span class="comment">if the buffer already exists
</span>      (switch-to-buffer command)        <span class="comment-delimiter">; </span><span class="comment">then just switch to it
</span>    (switch-to-buffer command)          <span class="comment-delimiter">; </span><span class="comment">otherwise create it
</span>    (insert (shell-command-to-string command)) <span class="comment-delimiter">; </span><span class="comment">prepare its contents
</span>    (goto-char (point-min)))            <span class="comment-delimiter">; </span><span class="comment">and place point at its beginning
</span>  (apply 'ee-goto-position pos-spec-list))

<span class="comment-delimiter">;; </span><span class="comment">(defalias 'find-sh0 'shell-command-to-string)
</span>(<span class="keyword">defun</span> <a name="find-sh0"><span class="function-name">find-sh0</span></a> (command)
  (replace-regexp-in-string <span class="string">"\n$"</span> <span class="string">""</span> (shell-command-to-string command)))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">hyperlinks to manpages
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defadvice</span> <a name="Man-notify-when-ready"><span class="function-name">Man-notify-when-ready</span></a> (around find-man (man-buffer) activate)
  (<span class="keyword">if</span> (not ee-find-man-flag)
      ad-do-it
    (switch-to-buffer man-buffer)
    (apply 'ee-goto-position ee-find-man-pos-spec-list)
    (setq ee-find-man-flag nil)))

(<span class="keyword">defun</span> <a name="find-man"><span class="function-name">find-man</span></a> (manpage <span class="type">&amp;rest</span> pos-spec-list)
  (interactive (list (ee-manpagename-ask)))
  (setq ee-find-man-flag t
        ee-find-man-pos-spec-list pos-spec-list)
    (man manpage))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">hyperlinks to files in html
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="find-w3m"><span class="function-name">find-w3m</span></a> (url <span class="type">&amp;rest</span> rest)
  (interactive <span class="string">"Murl: "</span>)
  (<span class="keyword">let</span> ((enable-local-variables nil)    <span class="comment-delimiter">; </span><span class="comment">workaround for a w3m-el bug
</span>        (w3m-async-exec nil))
    (w3m (replace-regexp-in-string <span class="string">"^/"</span> <span class="string">"file:///"</span> (ee-expand url))))
  (ee-goto-rest rest))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">hyperlinks to pages in dvi/ps/pdf documents
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="find-dvipage"><span class="function-name">find-dvipage</span></a> (fname <span class="type">&amp;optional</span> n <span class="type">&amp;rest</span> ignore)
  (interactive <span class="string">"fDVI file: "</span>)
  (<span class="keyword">let</span> ((command (format <span class="string">"xdvi +%d %s &amp;"</span> (or n 1) fname)))
    (eev command nil)
    command))

(<span class="keyword">defun</span> <a name="find-pspage"><span class="function-name">find-pspage</span></a> (fname <span class="type">&amp;optional</span> n <span class="type">&amp;rest</span> ignore)
  (interactive <span class="string">"fPS or PDF file: "</span>)
  (<span class="keyword">let</span> ((command (format <span class="string">"gv -page %d %s &amp;"</span> (or n 1) fname)))
    (eev command nil)
    command))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">hyperlinks to anchors
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="find-anchor"><span class="function-name">find-anchor</span></a> (fname <span class="type">&amp;optional</span> tag <span class="type">&amp;rest</span> rest)
  (find-fline fname)
  (<span class="keyword">if</span> tag (apply 'ee-goto-position (format ee-anchor-format tag) rest)))

(<span class="keyword">defun</span> <a name="ee-to"><span class="function-name">ee-to</span></a> (anchor <span class="type">&amp;rest</span> rest)
  (interactive <span class="string">"sAnchor: "</span>)
  (apply 'ee-goto-position (format ee-anchor-format anchor) rest))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">hyperlinks to information about Debian packages
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="find-Package"><span class="function-name">find-Package</span></a> (fname <span class="type">&amp;optional</span> packagename <span class="type">&amp;rest</span> rest)
  (find-fline fname)
  (<span class="keyword">if</span> packagename
      (apply 'ee-goto-position (format <span class="string">"\nPackage: %s\n"</span> packagename) rest)))

(<span class="keyword">defun</span> <a name="find-status"><span class="function-name">find-status</span></a> (packagename <span class="type">&amp;rest</span> rest)
  (interactive (list (ee-debpkgname-ask)))
  (apply 'find-Package <span class="string">"/var/lib/dpkg/status"</span> packagename rest))

(<span class="keyword">defun</span> <a name="find-available"><span class="function-name">find-available</span></a> (packagename <span class="type">&amp;rest</span> rest)
  (interactive (list (ee-debpkgname-ask)))
  (apply 'find-Package <span class="string">"/var/lib/dpkg/available"</span> packagename rest))

(<span class="keyword">defun</span> <a name="find-grep-status"><span class="function-name">find-grep-status</span></a> (grepargs <span class="type">&amp;rest</span> rest)
  (interactive <span class="string">"sgrep-status "</span>)
  (apply 'find-sh (concat <span class="string">"grep-status "</span> grepargs) rest))

(<span class="keyword">defun</span> <a name="find-grep-available"><span class="function-name">find-grep-available</span></a> (grepargs <span class="type">&amp;rest</span> rest)
  (interactive <span class="string">"sgrep-available "</span>)
  (apply 'find-sh (concat <span class="string">"grep-available "</span> grepargs) rest))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">mass-producing hyperlink functions
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="ee-eval-read-format"><span class="function-name">ee-eval-read-format</span></a> (formatstr <span class="type">&amp;rest</span> rest)
  (<span class="keyword">let</span> ((s (apply 'format formatstr     <span class="comment-delimiter">; </span><span class="comment">or (concat "(progn " formatstr ")")
</span>                  rest)))
    (<span class="keyword">if</span> ee-arg (insert <span class="string">"\n"</span> s)          <span class="comment-delimiter">; </span><span class="comment">for debugging
</span>      (eval (read s)))))

(<span class="keyword">defun</span> <a name="code-ps"><span class="function-name">code-ps</span></a> (code psfile)
  (ee-eval-read-format
   <span class="string">"(defun find-%spage (n &amp;rest comments) (find-pspage %S n))"</span>
   code psfile))

(<span class="keyword">defun</span> <a name="code-dvi"><span class="function-name">code-dvi</span></a> (code dvifile)
  (ee-eval-read-format
   <span class="string">"(defun find-%spage (n &amp;rest comments) (find-dvipage %S n))"</span>
   code dvifile))



(<span class="keyword">defun</span> <a name="ee-find-tag"><span class="function-name">ee-find-tag</span></a> (tag <span class="type">&amp;rest</span> pos-spec-list)
  (<span class="keyword">let</span> ((tags-add-tables nil))
    (find-tag tag))
  (ee-goto-rest pos-spec-list))

<span class="comment-delimiter">;; </span><span class="comment">This `</span><span class="comment"><span class="constant">ee-read-file-name</span></span><span class="comment">' is semi-bogus and needs fixing.
</span><span class="comment-delimiter">;; </span><span class="comment">A test: (ee-read-file-name nil data-directory)
</span><span class="comment-delimiter">;; </span><span class="comment">Remember, its result will be concatenated to ee-xxxdir.
</span><span class="comment-delimiter">;; </span><span class="comment">When it returns absolute filenames things break.
</span><span class="comment-delimiter">;;</span><span class="comment">
</span>(<span class="keyword">defun</span> <a name="ee-read-file-name"><span class="function-name">ee-read-file-name</span></a> (prompt defaultdir)
  (<span class="keyword">let</span> ((default-directory (or defaultdir default-directory)))
    (read-file-name (or prompt <span class="string">"Find file: "</span> nil) nil <span class="string">"."</span>)))

(<span class="keyword">defun</span> <a name="ee-find-codenode"><span class="function-name">ee-find-codenode</span></a> (code infofile nodename <span class="type">&amp;rest</span> pos-spec-list)
  (<span class="keyword">if</span> code (setq ee-info-code code
                 ee-info-file infofile))
  (apply 'find-node (format <span class="string">"(%s)%s"</span> infofile nodename) pos-spec-list))

(<span class="keyword">defun</span> <a name="ee-find-cd-sh"><span class="function-name">ee-find-cd-sh</span></a> (dir command <span class="type">&amp;rest</span> pos-spec-list)
  (find-sh (format <span class="string">"cd %s\n%s"</span> dir command) pos-spec-list))
(<span class="keyword">defun</span> <a name="ee-find-cd-sh0"><span class="function-name">ee-find-cd-sh0</span></a> (dir command)
  (find-sh0 (format <span class="string">"cd %s\n%s"</span> dir command)))

(<span class="keyword">defun</span> <a name="ee-aref"><span class="function-name">ee-aref</span></a> (alist idx)
  <span class="doc">"Like `</span><span class="doc"><span class="constant">aref</span></span><span class="doc">', but for alists."</span>
  (cdr (assoc idx alist)))
(<span class="keyword">defun</span> <a name="ee-adel"><span class="function-name">ee-adel</span></a> (alist idx)
  <span class="doc">"Like `</span><span class="doc"><span class="constant">remq</span></span><span class="doc">', but for alists. This is non-destructive, so wrap it in a setq."</span>
  (remq (assoc idx alist) alist))
(<span class="keyword">defun</span> <a name="ee-aset"><span class="function-name">ee-aset</span></a> (alist idx newelt)
  <span class="doc">"Like `</span><span class="doc"><span class="constant">aset</span></span><span class="doc">', but for alists. This is non-destructive, so wrap it in a setq."</span>
  (cons (cons idx newelt) (ee-adel alist idx)))

(<span class="keyword">defun</span> <a name="code-c-d-register"><span class="function-name">code-c-d-register</span></a> (c d)
  <span class="doc">"Add the pair (C D) to `</span><span class="doc"><span class="constant">code-c-d-list</span></span><span class="doc">'.
If `</span><span class="doc"><span class="constant">code-c-d-list</span></span><span class="doc">' already has an entry with the same C delete
the previous one. The new entry is always added to the beginning
of the list."</span>
  (<span class="keyword">let</span> ((c-d (assoc c code-c-d-list)))
    (<span class="keyword">if</span> c-d (setq code-c-d-list (delq c-d code-c-d-list))))
  (setq code-c-d-list (cons (list c d) code-c-d-list)))

(<span class="keyword">defun</span> <a name="code-c-d"><span class="function-name">code-c-d</span></a> (c d <span class="type">&amp;optional</span> infofile)
  (ee-eval-read-format <span class="string">"(setq ee-%sdir \"%s\")"</span> c d)
  (ee-eval-read-format <span class="string">"(setq ee-%stagsfile \"%sTAGS\")"</span> c d)
  (ee-eval-read-format <span class="string">"
    (defun ee-%sfile (str)
      (concat (ee-expand ee-%sdir) str))"</span> c c)
  (ee-eval-read-format <span class="string">"
    (defun ee-use-%s-tags ()
      (setq tags-file-name ee-%stagsfile))"</span> c c)
  (ee-eval-read-format <span class="string">"
    (defun find-%sfile (str &amp;rest pos-spec-list)
      (interactive (list \"\"))
      (ee-use-%s-tags)
      (apply 'find-fline (ee-%sfile str) pos-spec-list))"</span> c c c)
  (ee-eval-read-format <span class="string">"
    (defun find-%stag (str &amp;rest pos-spec-list)
      (ee-use-%s-tags) (apply 'ee-find-tag str pos-spec-list))"</span> c c)
  (ee-eval-read-format <span class="string">"
    (defun find-%ssh (command &amp;rest pos-spec-list)
      (apply 'ee-find-cd-sh ee-%sdir command pos-spec-list))"</span> c c)
  (ee-eval-read-format <span class="string">"
    (defun find-%ssh0 (command)
      (apply 'ee-find-cd-sh0 ee-%sdir command))"</span> c c)
  (ee-eval-read-format <span class="string">"
    (defun find-%sw3m (furl &amp;rest pos-spec-list)
      (apply 'find-w3m (ee-%sfile furl) pos-spec-list))"</span> c c)
  (ee-eval-read-format <span class="string">"(setq ee-info-code %S)"</span> c)
  (ee-eval-read-format <span class="string">"(setq ee-info-file %S)"</span> c)
  (<span class="keyword">if</span> infofile
      (ee-eval-read-format <span class="string">"
        (defun find-%snode (nodename &amp;rest pos-spec-list)
          (apply 'ee-find-codenode %S %S nodename pos-spec-list))
        "</span> c c infofile))
  (<span class="keyword">unless</span> (equal d <span class="string">""</span>)
    (code-c-d-register c (ee-expand d)))
  c)


(<span class="keyword">defun</span> <a name="code-c-d-anchor"><span class="function-name">code-c-d-anchor</span></a> (c d <span class="type">&amp;optional</span> infofile)
  (code-c-d c d infofile)
  (ee-eval-read-format <span class="string">"
    (defun find-%s (file &amp;rest rest)
      (apply 'find-anchor (ee-%sfile file) rest))"</span> c c))

(<span class="keyword">defun</span> <a name="code-c-d-linux"><span class="function-name">code-c-d-linux</span></a> (c d)
  (code-c-d c d)
  (ee-eval-read-format <span class="string">"
    (defun find-%sconfvar (var &amp;rest rest)
      (apply 'find-%sfile \"Documentation/Configure.help\"
             (concat \"\\n\" var \"\\n\") rest))"</span> c c))

<span class="comment-delimiter">;; </span><span class="comment">Untested: the eegud functions have changed.
</span>(<span class="keyword">defun</span> <a name="code-c-d-gdb"><span class="function-name">code-c-d-gdb</span></a> (c d <span class="type">&amp;optional</span> infofile)
  (code-c-d c d infofile)
  (ee-eval-read-format <span class="string">"
    (defun eeb-%sgdb-start (once &amp;optional fname)
      (ee-use-%s-tags)
      (eeb-gdb-start (once ee-%sdir fname)))"</span> c c c))


<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">mass-producing hyperlink functions: examples (debian-centric)
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(setq ee-emacs-lisp-directory
  (or (file-name-directory (locate-library <span class="string">"loadup.el"</span>))
      (format <span class="string">"/usr/share/emacs/%d.%d/lisp/"</span>
              emacs-major-version emacs-minor-version)))

(code-c-d <span class="string">"e"</span>   ee-emacs-lisp-directory <span class="string">"emacs"</span>)
(code-c-d <span class="string">"el"</span>  ee-emacs-lisp-directory <span class="string">"elisp"</span>)
(code-c-d <span class="string">"eli"</span> ee-emacs-lisp-directory <span class="string">"emacs-lisp-intro"</span>)
(code-c-d <span class="string">"eetc"</span> data-directory)

(code-c-d-anchor <span class="string">"eev"</span>    <span class="string">"$EEVDIR/"</span> <span class="string">"eev"</span>)     <span class="comment-delimiter">; <a href="eev-dev.el">(find-eevfile "eev-dev.el")</a></span><span class="comment">
</span>(code-c-d-anchor <span class="string">"eevtmp"</span> <span class="string">"$EEVTMPDIR/"</span>)        <span class="comment-delimiter">; </span><span class="comment">(find-eevtmpfile "")
</span>(code-c-d-anchor <span class="string">"eevrc"</span>  <span class="string">"$EEVRCDIR/"</span>)         <span class="comment-delimiter">; </span><span class="comment">(find-eevrcfile "")
</span>(code-c-d-anchor <span class="string">"eevex"</span>  <span class="string">"$EEVDIR/examples/"</span>)  <span class="comment-delimiter">; <a href="examples/">(find-eevexfile "")</a></span><span class="comment">
</span>
(code-c-d <span class="string">"ud"</span> <span class="string">"/usr/share/doc/"</span>)        <span class="comment-delimiter">; </span><span class="comment">(find-udfile "bash/")
</span>(code-c-d <span class="string">"vldi"</span> <span class="string">"/var/lib/dpkg/info/"</span>)  <span class="comment-delimiter">; </span><span class="comment">(find-vldifile "bash.list")
</span>
(code-c-d <span class="string">"bash"</span> (ee-udfile <span class="string">"bash/"</span>) <span class="string">"bashref"</span>)
(code-c-d <span class="string">"zsh"</span>  (ee-udfile <span class="string">"zsh/"</span>)  <span class="string">"zsh"</span>)
(code-c-d <span class="string">"apthowto"</span> <span class="string">"/usr/share/doc/Debian/apt-howto/"</span>)



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">temporary highlighting (flashing)
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="eeflash"><span class="function-name">eeflash</span></a> (start end <span class="type">&amp;optional</span> face duration)
  <span class="doc">"Highlight the region between START and END using FACE, for time DURATION."</span>
  (<span class="keyword">let</span> ((ovl (make-overlay start end)))
    (overlay-put ovl 'face (or face 'region))
    (run-at-time (or duration 1) nil 'delete-overlay ovl)))

(<span class="keyword">defun</span> <span class="function-name">eeflash+</span> (s <span class="type">&amp;optional</span> e spec add-to-e)
  <span class="doc">"Highlight the region between S and E; face and duration are taken from SPEC.
This function only tries to do any work when S is a number and SPEC is non-nil.
When SPEC is non-nil it should be a pair of the form (FACE DURATION).
The argument ADD-TO-E is a hack for when we know that the region between S and
E+1 ends with a newline and it looks nicer to highlight the newline too; then
we set ADD-TO-E to 1."</span>
  (<span class="keyword">if</span> (and (numberp s) spec)
      (eeflash s (+ e (or add-to-e 0))
               (car spec) (cadr spec)))
  (list s e spec add-to-e))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">evaluating sexps (alternatives to eval-last-sexp)
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
<span class="comment-delimiter">;; </span><span class="comment">ee-eval-sexp-eol may be obsolete
</span><span class="comment-delimiter">;; </span><span class="comment">ee-arg is still used in eev-insert.el (ack!)
</span><span class="comment-delimiter">;;</span><span class="comment">
</span>
<span class="comment-delimiter">;; </span><span class="comment">We used to have
</span><span class="comment-delimiter">;; </span><span class="comment">M-e -&gt; `</span><span class="comment"><span class="constant">ee-eval-sexp-eol</span></span><span class="comment">', but now it's
</span><span class="comment-delimiter">;; </span><span class="comment">M-e -&gt; `</span><span class="comment"><span class="constant">eek-eval-sexp-eol</span></span><span class="comment">' and `</span><span class="comment"><span class="constant">ee-eval-sexp-eol</span></span><span class="comment">' is not bound to
</span><span class="comment-delimiter">;; </span><span class="comment">any key.
</span><span class="comment-delimiter">;;</span><span class="comment">
</span>(<span class="keyword">defun</span> <a name="ee-eval-sexp-eol"><span class="function-name">ee-eval-sexp-eol</span></a> (ee-arg)        <span class="comment-delimiter">; </span><span class="comment">this ee-arg shadows the global one
</span>  (interactive <span class="string">"P"</span>)
  (end-of-line)
  (eval-last-sexp nil))

<span class="comment-delimiter">;; </span><span class="comment">See (find-efunction 'eval-last-sexp-1)
</span>(<span class="keyword">defun</span> <a name="eek-backward-sexp"><span class="function-name">eek-backward-sexp</span></a> ()
  (<span class="keyword">with-syntax-table</span> emacs-lisp-mode-syntax-table
    (forward-sexp -1)
    (<span class="keyword">when</span> (eq (preceding-char) ?\\)
      (forward-char -1)
      (<span class="keyword">when</span> (eq (preceding-char) ??)
        (forward-char -1))))
  (point))

(<span class="keyword">defun</span> <a name="eek-forward-sexp"><span class="function-name">eek-forward-sexp</span></a> ()
  (<span class="keyword">with-syntax-table</span> emacs-lisp-mode-syntax-table
    (forward-sexp 1))
  (point))

(<span class="keyword">defun</span> <a name="eek-last-sexp"><span class="function-name">eek-last-sexp</span></a> ()
  (<span class="keyword">save-excursion</span>
    (buffer-substring-no-properties
     (eek-backward-sexp) (eek-forward-sexp))))

(<span class="keyword">defun</span> <a name="eek-eval-last-sexp"><span class="function-name">eek-eval-last-sexp</span></a> (<span class="type">&amp;optional</span> arg)
  (interactive <span class="string">"P"</span>)
  (<span class="keyword">cond</span> ((eq arg 0)
         (<span class="keyword">save-excursion</span>
           (eeflash+ (eek-backward-sexp) (eek-forward-sexp)
                     eek-highlight-spec)))
        ((eq arg 1) (prin1 (eek-last-sexp)))
        ((eq arg 2) (prin1 (read (eek-last-sexp))))
        ((eq arg 3) (eval (read (eek-last-sexp))))
        ((eq arg 4) (<span class="keyword">let</span> ((sexp (read (eek-last-sexp)))) (debug) (eval sexp)))
        ((eq arg 5) (<span class="keyword">let</span> ((sexp (read (eek-last-sexp)))
                          (debug-on-error t))
                      (eval sexp)))
        ((eq arg 8) (find-epp (eval (read (eek-last-sexp)))))
        ((eq arg 9) (<span class="keyword">let</span> ((interactive-clause (read (eek-last-sexp))))
                      (call-interactively
                       `(<span class="keyword">lambda</span> (<span class="type">&amp;rest</span> args) ,interactive-clause
                          (message <span class="string">"%S"</span> args)))))
        (t (prin1 (<span class="keyword">let</span> ((ee-arg arg))
                    (eval (read (eek-last-sexp))))))))

(<span class="keyword">defun</span> <a name="eek-eval-sexp-eol"><span class="function-name">eek-eval-sexp-eol</span></a> (<span class="type">&amp;optional</span> arg)
  (interactive <span class="string">"P"</span>)
  (end-of-line)
  (eek-eval-last-sexp arg))




<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">saving regions (as temporary sripts)
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="ee-se-to-string"><span class="function-name">ee-se-to-string</span></a> (s e)
  (<span class="keyword">cond</span> ((numberp s) (buffer-substring-no-properties s e))
        ((stringp s) s)))

(<span class="keyword">defun</span> <a name="octal-to-num"><span class="function-name">octal-to-num</span></a> (str)
  (<span class="keyword">let</span> ((lastv (- (string-to-char (substring str -1)) ?0))
        (rest (substring str 0 -1)))
    (<span class="keyword">if</span> (string= <span class="string">""</span> rest) lastv (+ lastv (* 8 (octal-to-num rest))))))

(<span class="keyword">defun</span> <a name="ee-write-string"><span class="function-name">ee-write-string</span></a> (str <span class="type">&amp;optional</span> altfile fmode)
  (<span class="keyword">let</span> ((fname (substitute-in-file-name (or altfile ee-file))))
    (write-region str nil fname)        <span class="comment-delimiter">; </span><span class="comment">a standard kludge
</span>    (<span class="keyword">if</span> fmode (set-file-modes fname (octal-to-num fmode)))))

(<span class="keyword">defun</span> <a name="ee-write"><span class="function-name">ee-write</span></a> (s e pre post <span class="type">&amp;optional</span> altfile fmode)
  (ee-write-string (concat pre (ee-se-to-string s e) post)
                   altfile fmode))

(<span class="keyword">defun</span> <a name="ee-se-to-string-with-nl"><span class="function-name">ee-se-to-string-with-nl</span></a> (s e)
  (<span class="keyword">let</span> ((str (ee-se-to-string s e)))
    (<span class="keyword">if</span> (string-match <span class="string">"[</span><span class="string"><span class="negation-char">^</span></span><span class="string">\n]\\'"</span> str) (concat str <span class="string">"\n"</span>) str)))

(<span class="keyword">defun</span> <a name="ee-write-with-nl"><span class="function-name">ee-write-with-nl</span></a> (s e pre post <span class="type">&amp;optional</span> altfile fmode)
  (ee-write-string (concat pre (ee-se-to-string-with-nl s e) post)
                   altfile fmode))



(<span class="keyword">defun</span> <a name="eev"><span class="function-name">eev</span></a> (s <span class="type">&amp;optional</span> e altfile)
  (interactive <span class="string">"r"</span>)
  (ee-write-with-nl s e <span class="string">""</span> <span class="string">""</span> altfile)
  (format <span class="string">"eev: wrote %s"</span> (or altfile ee-file)))

(<span class="keyword">defun</span> <a name="eevs"><span class="function-name">eevs</span></a> (s <span class="type">&amp;optional</span> e suffix)
  (interactive <span class="string">"r\nsSuffix: "</span>)
  (eev s e (concat ee-file suffix)))

(<span class="keyword">defun</span> <a name="eelatex"><span class="function-name">eelatex</span></a> (s <span class="type">&amp;optional</span> e)
  (interactive <span class="string">"r"</span>)
  (ee-write s e <span class="string">""</span> <span class="string">""</span> ee-file-tex)
  (eev eelatex-eevscript nil)
  (format <span class="string">"eelatex: wrote %s and %s"</span> ee-file-tex ee-file))

(<span class="keyword">defun</span> <a name="eegdb"><span class="function-name">eegdb</span></a> (s <span class="type">&amp;optional</span> e)
  (interactive <span class="string">"r"</span>)
  (ee-write s e <span class="string">""</span> <span class="string">""</span> ee-file-gdb)
  (format <span class="string">"eegdb: wrote %s"</span> ee-file-gdb))

(<span class="keyword">defun</span> <a name="eeg"><span class="function-name">eeg</span></a> (s <span class="type">&amp;optional</span> e)
  (interactive <span class="string">"r"</span>)
  (ee-write s e <span class="string">""</span> <span class="string">""</span> ee-file-generic)
  (format <span class="string">"eeg: wrote %s"</span> ee-file-gdb))

(<span class="keyword">defun</span> <a name="eeeval"><span class="function-name">eeeval</span></a> (s <span class="type">&amp;optional</span> e)
  (interactive <span class="string">"r"</span>)
  (eval (read (concat <span class="string">"(progn "</span> (ee-se-to-string s e) <span class="string">"\n)"</span>))))



(<span class="keyword">defun</span> <a name="ee-default-directory"><span class="function-name">ee-default-directory</span></a> ()
  (<span class="keyword">if</span> (eq major-mode 'w3-mode)
      (<span class="keyword">let</span> ((url (url-view-url 0)))
        (<span class="keyword">if</span> (string-match <span class="string">"^file:</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">.*/</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">/]*$"</span> url)
            (match-string 1 url)
          (<span class="warning">error</span> <span class="string">"Current url is %S, which is not a local file"</span> url)))
    default-directory))

<span class="comment-delimiter">;; </span><span class="comment">2005jan10, incompatible change: added "dir"
</span>(<span class="keyword">defun</span> <a name="eecd"><span class="function-name">eecd</span></a> (<span class="type">&amp;optional</span> dir command)
  (interactive)
  (eev (concat <span class="string">"cd "</span> (or dir (ee-default-directory)) <span class="string">"\n"</span>
               (or command <span class="string">""</span>))))




<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">auxiliary functions for saving delimited ("bounded") regions
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="ee-search-backward"><span class="function-name">ee-search-backward</span></a> (str)
  (+ (<span class="keyword">save-excursion</span> (search-backward str))
     (length str)))
(<span class="keyword">defun</span> <a name="ee-search-forward"><span class="function-name">ee-search-forward</span></a> (str <span class="type">&amp;optional</span> adjust)
  (+ (<span class="keyword">save-excursion</span> (search-forward str))
     (- (length str))
     (or adjust 0)))

(<span class="keyword">defun</span> <a name="ee-prefixp"><span class="function-name">ee-prefixp</span></a> (prefix str)
  <span class="doc">"Return t if STR begins with PREFIX."</span>
  (and (&lt;= (length prefix) (length str))
       (equal prefix (substring str 0 (length prefix)))))

(<span class="keyword">defun</span> <span class="function-name">ee-sedelims+-to-se+</span> (sdelim <span class="type">&amp;optional</span> edelim flash-spec add-to-e)
  (list (ee-search-backward sdelim) (ee-search-forward edelim)
        flash-spec add-to-e))

(<span class="keyword">defun</span> <span class="function-name">ee-sedelims++-to-sedelims+</span> (sdelim <span class="type">&amp;optional</span> edelim flash-spec add-to-e)
  (<span class="keyword">if</span> (not edelim) (setq edelim sdelim))
  (<span class="keyword">if</span> (symbolp sdelim) (setq sdelim (symbol-value sdelim)))
  (<span class="keyword">if</span> (symbolp edelim) (setq edelim (symbol-value edelim)))
  (<span class="keyword">if</span> (eq flash-spec t) (setq flash-spec 'eeflash-default))
  (<span class="keyword">if</span> (symbolp flash-spec) (setq flash-spec (symbol-value flash-spec)))
  (<span class="keyword">if</span> (eq add-to-e t) (setq add-to-e (<span class="keyword">if</span> (ee-prefixp <span class="string">"\n"</span> edelim) 1 0)))
  (list sdelim edelim flash-spec add-to-e))

<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">the default action on bounded regions
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="eeb-default"><span class="function-name">eeb-default</span></a> ()
  (interactive)
  (<span class="keyword">let*</span> ((fun (car eeb-defaults))
         (sedelims++ (cdr eeb-defaults))
         (sedelims+ (apply 'ee-sedelims++-to-sedelims+ sedelims++))
         (se+ (apply 'ee-sedelims+-to-se+ sedelims+)))
    (apply 'eeflash+ se+)
    (funcall fun (car se+) (cadr se+))))

<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">saving delimited regions
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="eeb-define"><span class="function-name">eeb-define</span></a> (eexxx-bounded
                   eexxx sdelim <span class="type">&amp;optional</span>   edelim flash-spec add-to-e)
  (<span class="keyword">let</span> ((eexxx-sedelims+ (list eexxx sdelim edelim flash-spec add-to-e)))
    (set eexxx-bounded eexxx-sedelims+))
  (eval `(<span class="keyword">defun</span> ,eexxx-bounded ()
           (interactive)
           (setq eeb-defaults ,eexxx-bounded)
           (eeb-default))))

(<span class="keyword">defmacro</span> <a name="eeb-once"><span class="function-name">eeb-once</span></a> (<span class="type">&amp;rest</span> body) `(<span class="keyword">let</span> (eeb-defaults) . ,body))
(<span class="keyword">defalias</span> '<a name="ee-once"><span class="function-name">ee-once</span></a> 'eeb-once)

(eeb-define 'eev-bounded     'eev     'ee-delimiter-hash      nil t t)
(eeb-define 'eeg-bounded     'eeg     'ee-delimiter-hash      nil t t)
(eeb-define 'eegdb-bounded   'eegdb   'ee-delimiter-hash      nil t t)
(eeb-define 'eelatex-bounded 'eelatex 'ee-delimiter-percent   nil t t)
(eeb-define 'eeb-eval        'eeeval  'ee-delimiter-semicolon nil t t)




<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">Hyperlinks to key sequences and series of Emacs actions
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="eesteps"><span class="function-name">eesteps</span></a> (list)
  <span class="doc">"Set the LIST of steps that `</span><span class="doc"><span class="constant">eesteps-do-step</span></span><span class="doc">' will execute.\n
Here's an example: run\n
  (eesteps '(\"C-x b * scratch * RET   ;;; change to the buffer *scratch*\"
             \"foobar\"
             \"3*&lt;left&gt;\"
             (insert \"!\")))\n
then type \\[</span><span class="doc"><span class="constant">eesteps-do-step</span></span><span class="doc">] four times.\n
Each step is either a string -- meaning a series of keys, in the
format used by `</span><span class="doc"><span class="constant">edmacro-mode</span></span><span class="doc">' -- or a sexp to be evaluated."</span>
  (setq eesteps-pos 0)
  (setq eesteps-list list)
  `(,(length list) steps stored - use &lt;f12&gt; to execute a step))

(<span class="keyword">defun</span> <a name="eek"><span class="function-name">eek</span></a> (s <span class="type">&amp;optional</span> e count)
  (interactive <span class="string">"r"</span>)
  <span class="string">"Execute the region between S and E (or the string S) as a keyboard macro.
See `</span><span class="string"><span class="constant">edmacro-mode</span></span><span class="string">' for the exact format.\n
An example: (eek \"C-x 4 C-h\")"</span>
  (execute-kbd-macro (read-kbd-macro (ee-se-to-string s e)) count))

(<span class="keyword">defun</span> <a name="eek0"><span class="function-name">eek0</span></a> (kbmacro <span class="type">&amp;optional</span> count)
  <span class="doc">"This is similar to `</span><span class="doc"><span class="constant">eek</span></span><span class="doc">', but uses the low-level formats for macros.
Example: (eek \"\\C-x4\\C-h\")"</span>
  (execute-kbd-macro kbmacro count))

(<span class="keyword">defun</span> <a name="eesteps-do-step"><span class="function-name">eesteps-do-step</span></a> ()
  (interactive)
  (<span class="keyword">if</span> (&gt;= eesteps-pos (length eesteps-list))
      (<span class="warning">error</span> <span class="string">"No more steps"</span>))
  (<span class="keyword">let</span> ((step (nth eesteps-pos eesteps-list)))
    (<span class="keyword">cond</span> ((stringp step) (eek step))
          (t (eval step))))
  (setq eesteps-pos (1+ eesteps-pos)))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">eev-newbie and eev-demos
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="eekl"><span class="function-name">eekl</span></a> (str <span class="type">&amp;rest</span> rest)
  (eek0 (concat str <span class="string">"\r"</span>))
  (<span class="keyword">if</span> rest (apply 'eekl rest)))

(<span class="keyword">defun</span> <a name="eekv"><span class="function-name">eekv</span></a> (str) (eek str) (message str))

<span class="comment-delimiter">;; </span><span class="comment">A hack for showing the region (temporarily) in Emacs &lt;= 21.1.3.
</span><span class="comment-delimiter">;; </span><span class="comment">These functions are used by some demos. They may be removed in the future.
</span><span class="comment-delimiter">;; </span><span class="comment">Note that in recent Emacsen C-SPC C-SPC &lt;movement&gt; highlights the region:
</span><span class="comment-delimiter">;; </span><span class="comment">(find-efile "ChangeLog" "temporary transient-mark-mode")
</span><span class="comment-delimiter">;; </span><span class="comment">(find-eetcfile "NEWS" "C-SPC C-SPC; this enables Transient Mark mode")
</span><span class="comment-delimiter">;;</span><span class="comment">
</span>(<span class="keyword">defun</span> <a name="eekr"><span class="function-name">eekr</span></a>  (str) (eek str)  (eeflash (point) (mark)))
(<span class="keyword">defun</span> <a name="eekvr"><span class="function-name">eekvr</span></a> (str) (eekv str) (eeflash (point) (mark)))

(<span class="keyword">defun</span> <a name="eev-newbie"><span class="function-name">eev-newbie</span></a> ()
  (interactive)
  (setq debug-on-error nil)
  (setq eval-expression-debug-on-error nil)
  (setq pop-up-windows nil)
  (message <span class="string">"Newbie settings activated.  Have you tried `M-x eev-demos'?"</span>))

(<span class="keyword">defun</span> <a name="eev-demos"><span class="function-name">eev-demos</span></a> (arg)
  (interactive <span class="string">"P"</span>)
  (find-eevexfile <span class="string">"demos.e"</span>)
  (<span class="keyword">if</span> (and arg (&gt;= arg 1) (&lt;= arg 5))
      (<span class="keyword">progn</span> (ee-goto-position (format <span class="string">"\n;; End of demo %d\n"</span> arg))
             (forward-line -2)
             (message <span class="string">"Type M-e to load the demo above the cursor."</span>))
    (message (concat <span class="string">"Use `M-1 M-x eev-demos' to go to the 1st demo,\n"</span>
                     <span class="string">"`M-2 M-x eev-demos' for the 2nd demo, etc (up to 4)."</span>))))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">more tools
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="ee-bol"><span class="function-name">ee-bol</span></a> () (point-at-bol))
(<span class="keyword">defun</span> <a name="ee-eol"><span class="function-name">ee-eol</span></a> () (point-at-eol))
(<span class="keyword">defun</span> <a name="ee-eval-string"><span class="function-name">ee-eval-string</span></a> (str) (eval (read (concat <span class="string">"(progn\n"</span> str <span class="string">"\n)"</span>))))

<span class="comment-delimiter">;; </span><span class="comment">(ee-flatten '((1 2 3) (4 5) (((6)) 7) nil nil 8 9))
</span><span class="comment-delimiter">;; </span><span class="comment">(ee-flatten '(1 2 3) '(4 5) '(((6)) 7) nil nil 8 9)
</span><span class="comment-delimiter">;;</span><span class="comment">
</span>(<span class="keyword">defun</span> <a name="ee-flatten"><span class="function-name">ee-flatten</span></a> (obj <span class="type">&amp;rest</span> rest)
  (<span class="keyword">cond</span> (rest (append (ee-flatten obj) (ee-flatten rest)))
        ((null obj) nil)
        ((listp obj) (append (ee-flatten (car obj)) (ee-flatten (cdr obj))))
        (t (list obj))))

(<span class="keyword">defun</span> <a name="ee-read-file"><span class="function-name">ee-read-file</span></a> (fname)
  (<span class="keyword">with-temp-buffer</span>
    (insert-file-contents fname)
    (buffer-string)))

(<span class="keyword">defun</span> <a name="ee-no-trailing-nl"><span class="function-name">ee-no-trailing-nl</span></a> (str)
  (replace-regexp-in-string <span class="string">"\n$"</span> <span class="string">""</span> str))




<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">starting background processes
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
<span class="comment-delimiter">;; </span><span class="comment">(eebg-xdvi "/usr/share/doc/gdb/refcard.dvi.gz")
</span><span class="comment-delimiter">;; </span><span class="comment">(eebg-gv "/usr/share/doc/gv/gv.ps.gz" 3 '("-scale" "-2"))
</span><span class="comment-delimiter">;; </span><span class="comment">(eebg-channel-xterm "A" "bash" '("-gravity" "nw"))
</span>
(<span class="keyword">defun</span> <a name="eebg-xdvi"><span class="function-name">eebg-xdvi</span></a> (fname <span class="type">&amp;optional</span> page xdviargs)
  (interactive <span class="string">"fdvi file: "</span>)
  (apply 'start-process <span class="string">"xdvi"</span> <span class="string">"*Messages*"</span>
         (ee-flatten
          <span class="string">"xdvi"</span> (<span class="keyword">if</span> page (format <span class="string">"+%d"</span> page)) xdviargs
          (ee-expand fname))))

(<span class="keyword">defun</span> <a name="eebg-gv"><span class="function-name">eebg-gv</span></a> (fname <span class="type">&amp;optional</span> page gvargs)
  (interactive <span class="string">"fPS or PDF file: "</span>)
  (apply 'start-process <span class="string">"gv"</span> <span class="string">"*Messages*"</span>
         (ee-flatten
          <span class="string">"gv"</span> (<span class="keyword">if</span> page (list <span class="string">"-page"</span> (format <span class="string">"%d"</span> page))) gvargs
          (ee-expand fname))))

(<span class="keyword">defun</span> <a name="eebg-channel-xterm"><span class="function-name">eebg-channel-xterm</span></a> (channel <span class="type">&amp;optional</span> prog-and-args xterm-args)
  <span class="doc">"This is the low-level way of creating an xterm listening on channel CHANNEL.
See `</span><span class="doc"><span class="constant">eechannel-xterm</span></span><span class="doc">'."</span>
  (interactive <span class="string">"sChannel: "</span>)
  (apply 'start-process (format <span class="string">"xterm (channel %s)"</span> channel) <span class="string">"*Messages*"</span>
         (ee-flatten
          <span class="string">"xterm"</span> <span class="string">"-T"</span> (concat <span class="string">"channel "</span> channel) xterm-args <span class="string">"-e"</span>
          (ee-expand <span class="string">"$EEVDIR/eegchannel"</span>) channel
          (or prog-and-args (ee-expand <span class="string">"$SHELL"</span>)))))



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">sending strings to external programs through "channels"
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="eechannel-pidfile"><span class="function-name">eechannel-pidfile</span></a> (channel)
  (ee-expand (format <span class="string">"$EEVTMPDIR/eeg.%s.pid"</span> channel)))
(<span class="keyword">defun</span> <a name="eechannel-strfile"><span class="function-name">eechannel-strfile</span></a> (channel)
  (ee-expand (format <span class="string">"$EEVTMPDIR/eeg.%s.str"</span> channel)))

(<span class="keyword">defun</span> <a name="eechannel-send"><span class="function-name">eechannel-send</span></a> (channel str)
  (<span class="keyword">if</span> (not channel) (setq channel eechannel-default))
  (ee-write str nil <span class="string">""</span> <span class="string">""</span> (eechannel-strfile channel))
  (find-sh0 (format <span class="string">"kill -USR1 $(cat %s)"</span> (eechannel-pidfile channel))))

(<span class="keyword">defun</span> <a name="eechannel"><span class="function-name">eechannel</span></a> (channel <span class="type">&amp;optional</span> str)
  (interactive <span class="string">"sDefault channel: "</span>)
  (<span class="keyword">if</span> (not str)
      (setq eechannel-default channel)
    (eechannel-send channel str)))

(<span class="keyword">defun</span> <a name="eechannel-do-this-line"><span class="function-name">eechannel-do-this-line</span></a> () (interactive)
  (<span class="keyword">let</span> ((line (buffer-substring (ee-bol) (ee-eol)))) <span class="comment-delimiter">; </span><span class="comment">contents of this line
</span>    (<span class="keyword">if</span> (string-match <span class="string">"^</span><span class="eev-glyph-face-red">*</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">.*</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">"</span> line)             <span class="comment-delimiter">; </span><span class="comment">lines with a red star
</span>        (ee-eval-string (match-string 1 line))       <span class="comment-delimiter">; </span><span class="comment">are eval'ed
</span>      (eechannel-send nil (concat line <span class="string">"\n"</span>)))       <span class="comment-delimiter">; </span><span class="comment">other lines are sent
</span>    (next-line 1)))                                  <span class="comment-delimiter">; </span><span class="comment">go down
</span>
(<span class="keyword">defun</span> <a name="eech"><span class="function-name">eech</span></a> (s <span class="type">&amp;optional</span> e)             <span class="comment-delimiter">; </span><span class="comment">bad name?
</span>  (interactive <span class="string">"r"</span>)
  (eechannel-send eechannel-default (ee-se-to-string s e)))

(eeb-define 'eech-bounded 'eech 'ee-delimiter-hash nil t t)



<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">sending strings through "channels": high-level functions
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="ee-pid-running-p"><span class="function-name">ee-pid-running-p</span></a> (pid)
  <span class="doc">"Return t if a process with pid PID is running. This is linux-specific."</span>
  (file-exists-p (format <span class="string">"/proc/%s"</span> pid)))

(<span class="keyword">defun</span> <a name="eechannel-pid"><span class="function-name">eechannel-pid</span></a> (channel)
  <span class="doc">"Note: this function returns either a pid (as a string) or nil."</span>
  (<span class="keyword">let</span> ((pidfile (eechannel-pidfile channel)))
    (<span class="keyword">if</span> (file-exists-p pidfile) (ee-no-trailing-nl (ee-read-file pidfile)))))

(<span class="keyword">defun</span> <a name="eechannel-running-p"><span class="function-name">eechannel-running-p</span></a> (channel)
  <span class="doc">"Returns t if there is a process listening on CHANNEL."</span>
  (<span class="keyword">let</span> ((pid (eechannel-pid channel)))
    (<span class="keyword">if</span> pid (ee-pid-running-p pid))))

(<span class="keyword">defun</span> <a name="eechannel-xterm"><span class="function-name">eechannel-xterm</span></a> (channel <span class="type">&amp;optional</span> prog-and-args xterm-args)
  <span class="doc">"If there's no process listening on CHANNEL then create an xterm there.
This function always sets the default channel to CHANNEL.
PROG-AND-ARGS and XTERM-ARGS are lists of strings: see `</span><span class="doc"><span class="constant">eebg-channel-xterm</span></span><span class="doc">'."</span>
  (interactive <span class="string">"sChannel: "</span>)
  (eechannel channel)
  (<span class="keyword">if</span> (eechannel-running-p channel)
      (message <span class="string">"Reusing channel %s"</span> channel)
    (eebg-channel-xterm channel prog-and-args xterm-args)))

(<span class="keyword">defun</span> <a name="eechannel-kill"><span class="function-name">eechannel-kill</span></a> (channel)
  <span class="doc">"Kill the process associated to channel CHANNEL."</span>
  (find-sh0 (format <span class="string">"kill -9 $(cat %s)"</span> (eechannel-pidfile channel))))






<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;</span><span class="comment">: eev keys mode
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defvar</span> <a name="eev-mode-map"><span class="variable-name">eev-mode-map</span></a> nil)
(<span class="keyword">if</span> eev-mode-map
    ()
(setq eev-mode-map (make-sparse-keymap))
(define-key eev-mode-map <span class="string">"\M-E"</span> 'eek-eval-last-sexp)    <span class="comment-delimiter">; </span><span class="comment">extends     C-x C-e
</span>(define-key eev-mode-map <span class="string">"\M-e"</span> 'eek-eval-sexp-eol)     <span class="comment-delimiter">; </span><span class="comment">extends C-e C-x C-e
</span>(define-key eev-mode-map <span class="string">"\M-k"</span> 'kill-this-buffer)      <span class="comment-delimiter">; </span><span class="comment">convenience
</span>(define-key eev-mode-map <span class="string">"\M-K"</span> 'bury-buffer)           <span class="comment-delimiter">; </span><span class="comment">convenience
</span>(define-key eev-mode-map [f3]   'eeb-default)
(define-key eev-mode-map [f9]   'eechannel-do-this-line)
(define-key eev-mode-map [f12]  'eesteps-do-step)
(define-key eev-mode-map <span class="string">"\M-G"</span> 'eegud-show-gud-buffer) <span class="comment-delimiter">; </span><span class="comment">hack, in eev-insert.el
</span>
(define-key eev-mode-map <span class="string">"\M-h\M-d"</span> 'find-debpkg-links)    <span class="comment-delimiter">; </span><span class="comment">in eev-insert.el
</span>(define-key eev-mode-map <span class="string">"\M-h\M-f"</span> 'find-efunction-links) <span class="comment-delimiter">; </span><span class="comment">in eev-insert.el
</span>(define-key eev-mode-map <span class="string">"\M-h\M-i"</span> 'find-einfo-links)     <span class="comment-delimiter">; </span><span class="comment">in eev-insert.el
</span>(define-key eev-mode-map <span class="string">"\M-h\M-k"</span> 'find-ekey-links)      <span class="comment-delimiter">; </span><span class="comment">in eev-insert.el
</span>(define-key eev-mode-map <span class="string">"\M-h\M-m"</span> 'find-manpage-links)   <span class="comment-delimiter">; </span><span class="comment">in eev-insert.el
</span>(define-key eev-mode-map <span class="string">"\M-h\M-v"</span> 'find-evariable-links) <span class="comment-delimiter">; </span><span class="comment">in eev-insert.el
</span>(define-key eev-mode-map <span class="string">"\M-hf"</span>    'find-file-links)      <span class="comment-delimiter">; </span><span class="comment">in eev-insert.el
</span>(define-key eev-mode-map <span class="string">"\M-hm"</span>    'find-last-manpage-links) <span class="comment-delimiter">;</span><span class="comment">in eev-insert.el
</span>(define-key eev-mode-map <span class="string">"\M-h\M-y"</span> 'eemklinks-yank-pos-spec) <span class="comment-delimiter">;</span><span class="comment">in eev-insert.el
</span>(define-key eev-mode-map <span class="string">"\M-h2"</span>    'eemklinks-duplicate-this-line) <span class="comment-delimiter">; </span><span class="comment">idem
</span>(define-key eev-mode-map <span class="string">"\M-h\M-2"</span> 'eemklinks-duplicate-this-line) <span class="comment-delimiter">; </span><span class="comment">idem
</span>(define-key eev-mode-map <span class="string">"\M-I"</span>     'ee-ill)               <span class="comment-delimiter">; </span><span class="comment">in eev-insert.el
</span>
(define-key eev-mode-map <span class="string">"\M-h\M-c"</span> 'describe-char)
(define-key eev-mode-map <span class="string">"\M-h\M-t"</span> 'find-etpat)
(define-key eev-mode-map <span class="string">"\M-ht"</span>    'find-etpat0)
(define-key eev-mode-map <span class="string">"\M-h\M-s"</span> 'find-efacedescr)
)

(<span class="keyword">define-minor-mode</span> <a name="eev-mode"><span class="function-name">eev-mode</span></a>
  <span class="doc">"Makes the keymap `</span><span class="doc"><span class="constant">eev-mode-map</span></span><span class="doc">' active."</span>
  <span class="builtin">:init-value</span> t <span class="builtin">:global</span> t)




<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;</span><span class="comment">: invading the global namespace
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defun</span> <a name="ee-invade-global-keymap"><span class="function-name">ee-invade-global-keymap</span></a> ())
(<span class="keyword">defun</span> <a name="ee-invade-global-namespace"><span class="function-name">ee-invade-global-namespace</span></a> ()
  (interactive)
  (<span class="keyword">defalias</span> '<a name="to"><span class="function-name">to</span></a>   'ee-to)
  <span class="comment-delimiter">;; </span><span class="comment">(defalias 'back 'ee-back)          ; oops - I removed `</span><span class="comment"><span class="constant">back</span></span><span class="comment">'
</span>  (<span class="keyword">defalias</span> '<a name="inn"><span class="function-name">inn</span></a>  'ee-inn)
  (<span class="keyword">defalias</span> '<a name="inns"><span class="function-name">inns</span></a> 'ee-inns)
  (<span class="keyword">defalias</span> '<a name="dff"><span class="function-name">dff</span></a>  'ee-dff)
  (<span class="keyword">defalias</span> '<a name="dfa"><span class="function-name">dfa</span></a>  'ee-dfa)
  (<span class="keyword">defalias</span> '<a name="ill"><span class="function-name">ill</span></a>  'ee-ill))

(<span class="keyword">defun</span> <a name="ee-invade-global-menu-bar"><span class="function-name">ee-invade-global-menu-bar</span></a> ())    <span class="comment-delimiter">; </span><span class="comment">I removed the menu code
</span>

<span class="comment-delimiter">;;;</span><span class="comment">
</span><span class="comment-delimiter">;;; </span><span class="comment">aliases for compatibility with previous versions
</span><span class="comment-delimiter">;;;</span><span class="comment">
</span>
(<span class="keyword">defalias</span> '<a name="ee-substitute-in-file-name"><span class="function-name">ee-substitute-in-file-name</span></a> 'ee-expand)
(<span class="keyword">defalias</span> '<a name="find-availablegrep"><span class="function-name">find-availablegrep</span></a> 'find-grep-available)
(<span class="keyword">defalias</span> '<a name="find-progoutput"><span class="function-name">find-progoutput</span></a> 'find-sh)

(<span class="keyword">defalias</span> '<a name="highlight-temporarily"><span class="function-name">highlight-temporarily</span></a>         'eeflash)
(<span class="keyword">defalias</span> '<a name="highlight-temporarily-by-spec"><span class="function-name">highlight-temporarily-by-spec</span></a> 'eeflash+)



<span class="comment-delimiter">;;; </span><span class="comment">The functions below are obsolete and semi-broken, don't use them!
</span><span class="comment-delimiter">;;; </span><span class="comment">The functions that called them now call `</span><span class="comment"><span class="constant">find-wottb-call</span></span><span class="comment">'.
</span><span class="comment-delimiter">;;</span><span class="comment">
</span><span class="comment-delimiter">;; </span><span class="comment">(defmacro ee-same-window (samewindowbuffername &amp;rest body)
</span><span class="comment-delimiter">;;   </span><span class="comment">`(let ((ee-old-pop-up-windows pop-up-windows))
</span><span class="comment-delimiter">;;      </span><span class="comment">(setq pop-up-windows nil)          ; "let pop-up-windows" doesn't work
</span><span class="comment-delimiter">;;      </span><span class="comment">(prog1 (progn . ,body)
</span><span class="comment-delimiter">;;        </span><span class="comment">(setq pop-up-windows ee-old-pop-up-windows))))
</span><span class="comment-delimiter">;;</span><span class="comment">
</span><span class="comment-delimiter">;; </span><span class="comment">(defmacro ee-same-window-contagious (samewindowbuffername &amp;rest body)
</span><span class="comment-delimiter">;;   </span><span class="comment">"Obsolete, don't use. Replaced by `</span><span class="comment"><span class="constant">find-wottb-call</span></span><span class="comment">'."
</span><span class="comment-delimiter">;;   </span><span class="comment">`(let ((pop-up-windows ee-pop-up-windows)) . ,body)) ; hack, not working
</span>
<span class="comment-delimiter">;; </span><span class="comment">`</span><span class="comment"><span class="constant">ee-ill</span></span><span class="comment">' needs another name.
</span><span class="comment-delimiter">;; </span><span class="comment">(find-efunction 'ee-ill)
</span><span class="comment-delimiter">;; </span><span class="comment">(global-set-key "\M-I" 'ee-ill)
</span>
<span class="comment-delimiter">;; <a href="http://www.gnu.org/software/emacs/elisp-manual/html_node/elisp_toc.html">(find-elnode "Active Keymaps")</a></span><span class="comment">
</span><span class="comment-delimiter">;; </span><span class="comment">overriding-local-map
</span><span class="comment-delimiter">;; </span><span class="comment">(current-local-map)
</span> 


<span class="comment-delimiter">;; </span><span class="comment">Local Variables:
</span><span class="comment-delimiter">;; </span><span class="comment">mode:              outline-minor
</span><span class="comment-delimiter">;; </span><span class="comment">coding:            raw-text-unix
</span><span class="comment-delimiter">;; </span><span class="comment">ee-anchor-format:  "</span><span class="eev-glyph-face-green">&#171;</span><span class="comment">%s</span><span class="eev-glyph-face-green">&#187;</span><span class="comment">"
</span><span class="comment-delimiter">;; </span><span class="comment">ee-anchor-format:  "defun %s "
</span><span class="comment-delimiter">;; </span><span class="comment">ee-comment-prefix: ";;"
</span><span class="comment-delimiter">;; </span><span class="comment">outline-regexp:    ";+:[;:]*"
</span><span class="comment-delimiter">;; </span><span class="comment">no-byte-compile:   t
</span><span class="comment-delimiter">;; </span><span class="comment">End:
</span></pre>
  </body>
</html>
